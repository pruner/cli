import { merge } from "../src/commands/run/state";

test("state: merge identical identifiers", () => {
	const oldObject = {
		id: "x1",
		name: "foo"
	};

	const newObject = {
		id: "x2",
		name: "blah"
	};

	let identifierChanges = [];

	const merged = merge({
		a: [oldObject],
		b: [newObject],
		groupingKeyProperty: "name",
		idProperty: "id",
		onIdentifierChanged: (a, b) => {
			identifierChanges.push([a, b]);
		}
	});

	expect(merged).toStrictEqual([
		{
			id: "x1",
			name: "blah"
		},
		{
			id: "x2",
			name: "foo"
		}
	]);

	expect(identifierChanges).toBe([
		["x2", "x1"]
	]);
});

// test("state: merge identical grouping keys", () => {
// 	const oldObject = {
// 		id: "x2",
// 		name: "foo"
// 	};

// 	const newObject = {
// 		id: "x1",
// 		name: "foo"
// 	};

// 	let identifierChanges = [];

// 	const merged = merge({
// 		a: [oldObject],
// 		b: [newObject],
// 		groupingKeyProperty: "name",
// 		idProperty: "id",
// 		onIdentifierChanged: (a, b) => {
// 			identifierChanges.push([a, b]);
// 		}
// 	});

// 	expect(merged).toStrictEqual([
// 		{
// 			id: "x1",
// 			name: "foo"
// 		}
// 	]);

// 	expect(identifierChanges).toBe("");
// 	expect(identifierChanges).toBe("");
// });

// test("state: merge identical grouping keys", () => {
// 	const oldObject = {
// 		id: "x1",
// 		name: "foo"
// 	};

// 	const newObject = {
// 		id: "x2",
// 		name: "foo"
// 	};

// 	let identifierChanges = [];

// 	const merged = merge({
// 		a: [oldObject],
// 		b: [newObject],
// 		groupingKeyProperty: "name",
// 		idProperty: "id",
// 		onIdentifierChanged: (a, b) => {
// 			identifierChanges.push([a, b]);
// 		}
// 	});

// 	expect(merged).toStrictEqual([
// 		{
// 			id: "x2",
// 			name: "foo"
// 		}
// 	]);

// 	expect(identifierChanges).toBe("");
// 	expect(identifierChanges).toBe("");
// });